# List of all command needed to flash a HiKey 620 4GB device
flash_cmds:
        - cmd: export PS1="$ "

        - cmd: cd /home/optee/devel/hikey/build

        - cmd: ls hikey.mk
          exp: hikey.mk

        - cmd: make CFG_FLASH_SIZE=4 recovery
          exp: "Press enter to continue"
          timeout: 10

        - cmd: "" # Enter from previous expect
          exp: 1. Connect USB OTG cable, the micro USB cable \(press enter\)

        - cmd: "" # Enter from previous expect
          exp: 2. Connect HiKey to power up \(press enter\)

        - cmd: "" # Enter from previous expect
          exp: "fastboot flash loader"

        - cmd: "" # Send one more "enter", which OP-TEE make expects
          exp: "sending 'ptable'"

        - exp: "writing 'ptable'..."
        - exp: "sending 'fastboot'..."
        - exp: "writing 'fastboot'..."
        - exp: "sending 'nvme'"
        - exp: "writing 'nvme'..."
        - exp: "sending 'boot'"
        - exp: "writing 'boot'..."

        - exp: "finished. total time:"
          timeout: 30

xtest_cmds:
        - exp: Starting tee-supplicant...
          timeout: 60

        - exp: Please press Enter to activate this console.
          timeout: 10

        - cmd: ""
          exp: root@HiKey:/

        - cmd: xtest
          exp: [ "test cases of which 0 failed", "root@HiKey:/" ] # Prompt means error
          error_pos: 1 # This indicates where the errors starts in the array above
          timeout: 1200

       # Start running the SDP tests
       # TODO: HiKey UART output gets mixed, we should update the PTA/SDP tests
       # to give a single final message telling whether SDP failed or not
       # - cmd: xtest --sdp-basic
       #   exp: "Secure Data Path basic access: NS invokes SDP TA"
       #   timeout: 10

       # - cmd: ""
       #   exp: Test passed
       #   timeout: 30

       # - cmd: ""
       #   exp: "Secure Data Path basic access: SDP TA invokes SDP TA"
       #   timeout: 5

       # - cmd: ""
       #   exp: Test passed
       #   timeout: 30

       # - cmd: ""
       #   exp: "Secure Data Path basic access: SDP TA invokes SDP pTA"
       #   timeout: 5

       # - cmd: ""
       #   exp: Test passed
       #   timeout: 30

       # - cmd: ""
       #   exp: "Secure Data Path basic access: NS invokes SDP pTA (shall fail)"
       #   timeout: 5

       # - cmd: ""
       #   exp: Test passed
       #   timeout: 30

build_init_cmds:
        # TODO: Preferably we should have all the necessary commands for build
        # here, just as for flash and xtest above. However I had issues with
        # pexpect after running repo sync. So for now I'm doing all repo setup
        # and building from this shell script instead. It works, but a bit ugly
        # and not how it was intended to be done from the beginning.
        - cmd: export PS1="$ "

        - cmd: /home/optee/devel/hikey_auto_boot/init_repo.sh
          exp: Done setting up HiKey project
          timeout: 120

build_cmds:
        - cmd: cd /home/optee/devel/hikey/build

        - cmd: ln -sf hikey.mk Makefile

        - cmd: /home/optee/devel/hikey_auto_boot/build.sh
          exp: [ "Done building HiKey", "Failed building HiKey" ]
          error_pos: 1 # This indicates where the errors starts in the array above
          timeout: 1200
